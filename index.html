<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>D·ª± B√°o Th·ªùi Ti·∫øt</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #e6f7ff; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        h1 { color: #007bff; text-align: center; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        input[type="text"] { width: 70%; padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #1e7e34; }
        #results { margin-top: 25px; padding: 20px; border: 1px solid #b3e0ff; background-color: #f0f8ff; border-radius: 8px; }
        .weather-info { margin-bottom: 15px; padding: 10px; border-left: 5px solid #007bff; background-color: #fff; }
        .weather-info strong { color: #333; display: inline-block; width: 150px; }
        .error { color: red; font-weight: bold; }
        .city-header { font-size: 1.5em; font-weight: bold; color: #0056b3; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üå§Ô∏è D·ª± B√°o Th·ªùi Ti·∫øt API</h1>
    
    <input type="text" id="cityInput" placeholder="Nh·∫≠p t√™n th√†nh ph·ªë (v√≠ d·ª•: Hanoi)">
    <button onclick="fetchWeather()">L·∫•y Th·ªùi Ti·∫øt</button>
    
    <div id="results">
        <p>Nh·∫≠p t√™n th√†nh ph·ªë v√† nh·∫•n n√∫t ƒë·ªÉ xem d·ª± b√°o.</p>
    </div>
</div>

<script>
    // ƒê·∫£m b·∫£o Port v√† Host n√†y tr√πng kh·ªõp v·ªõi c·∫•u h√¨nh Express c·ªßa b·∫°n
    const API_BASE_URL = "http://localhost:3000/weather"; // Ho·∫∑c port b·∫°n ƒë√£ c·∫•u h√¨nh

    async function fetchWeather() {
        const cityInput = document.getElementById('cityInput');
        const resultsDiv = document.getElementById('results');
        const cityCode = cityInput.value.trim();

        if (!cityCode) {
            resultsDiv.innerHTML = `<p class="error">Vui l√≤ng nh·∫≠p t√™n th√†nh ph·ªë!</p>`;
            return;
        }

        resultsDiv.innerHTML = `<p style="color: blue;">ƒêang g·ªçi API cho ${cityCode}...</p>`;

        try {
            const apiUrl = `${API_BASE_URL}/${encodeURIComponent(cityCode)}`; 
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (!response.ok) {
                const errorMessage = data.error || data.details || 'L·ªói kh√¥ng x√°c ƒë·ªãnh t·ª´ server.';
                resultsDiv.innerHTML = `<p class="error">L·ªói API (HTTP ${response.status}): ${errorMessage}</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                return;
            }
            
            // ----------------------------------------------------
            // üí° PH·∫¶N QUAN TR·ªåNG: TR√çCH XU·∫§T V√Ä HI·ªÇN TH·ªä D·ªÆ LI·ªÜU
            // Visual Crossing API tr·∫£ v·ªÅ d·ªØ li·ªáu ng√†y hi·ªán t·∫°i trong data.currentConditions
            
            const city = data.address || cityCode;
            const current = data.currentConditions;

            // Ki·ªÉm tra xem d·ªØ li·ªáu th·ªùi ti·∫øt c√≥ ƒë·∫ßy ƒë·ªß kh√¥ng
            if (!current) {
                resultsDiv.innerHTML = `<p class="error">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt hi·ªán t·∫°i cho ${city}.</p>`;
                return;
            }

            // L·∫•y c√°c gi√° tr·ªã c·∫ßn thi·∫øt
            const temperature = current.temp || 'N/A';
            const feelslike = current.feelslike || 'N/A';
            const humidity = current.humidity || 'N/A';
            const windspeed = current.windspeed || 'N/A'; // T·ªëc ƒë·ªô gi√≥ (km/h v√¨ ta d√πng unitGroup=metric)
            const conditions = current.conditions || 'N/A'; // D·ª± b√°o t√≥m t·∫Øt

            resultsDiv.innerHTML = `
                <div class="city-header">${city.toUpperCase()}</div>
                <div class="weather-info">
                    <strong>Nhi·ªát ƒë·ªô:</strong> ${temperature} ¬∞C
                </div>
                <div class="weather-info">
                    <strong>C·∫£m gi√°c nh∆∞:</strong> ${feelslike} ¬∞C
                </div>
                <div class="weather-info">
                    <strong>ƒê·ªô ·∫©m kh√¥ng kh√≠:</strong> ${humidity} %
                </div>
                <div class="weather-info">
                    <strong>T·ªëc ƒë·ªô gi√≥:</strong> ${windspeed} km/h
                </div>
                <div class="weather-info">
                    <strong>D·ª± b√°o t√≥m t·∫Øt:</strong> ${conditions}
                </div>
                <hr>
                <p style="font-size: 0.8em; color: #666;">(D·ªØ li·ªáu th√¥ JSON ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng)</p>
            `;
            // ----------------------------------------------------

        } catch (error) {
            resultsDiv.innerHTML = `<p class="error">L·ªói k·∫øt n·ªëi: ${error.message}. Server Express c√≥ ƒëang ch·∫°y kh√¥ng?</p>`;
        }
    }
</script>

</body>
</html>